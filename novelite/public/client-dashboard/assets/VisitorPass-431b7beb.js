var De=Object.defineProperty,ye=Object.defineProperties;var Te=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var se=(s,o,a)=>o in s?De(s,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[o]=a,C=(s,o)=>{for(var a in o||(o={}))ae.call(o,a)&&se(s,a,o[a]);if(M)for(var a of M(o))oe.call(o,a)&&se(s,a,o[a]);return s},b=(s,o)=>ye(s,Te(o));var ne=(s,o)=>{var a={};for(var c in s)ae.call(s,c)&&o.indexOf(c)<0&&(a[c]=s[c]);if(s!=null&&M)for(var c of M(s))o.indexOf(c)<0&&oe.call(s,c)&&(a[c]=s[c]);return a};import{Z as ke,j as e,e as Z,r as D,a4 as ue,V as we,L as P,R as re,P as Y,I as Ie}from"./index-5a3f6a76.js";import{B as _e}from"./Breadcrumb-fdd77327.js";import{P as Le}from"./PageContainer-ec8a92a5.js";import{B as r}from"./Box-4fe6d763.js";import{s as Ve,T as m}from"./Typography-36c6dc69.js";import{r as Be}from"./createSvgIcon-7fadfa12.js";import{k as pe,Q as $}from"./ReactToastify-b6ac6425.js";import{d as le,L as ce,A as de,D as me,T as Ne,a as Se}from"./TimeField-3eceba12.js";import{F as z,I as G,S as Q}from"./Select-306a1d3d.js";import{M as K}from"./MenuItem-e66f9b8b.js";import{T as O}from"./TextField-9d494300.js";import{D as Pe}from"./Divider-0b7a029c.js";import{D as J,P as Oe,d as $e}from"./Close-128233da.js";import{B as L}from"./Button-0fcc9acd.js";import{C as xe}from"./CircularProgress-3440d5f4.js";import{S as U}from"./Stack-5dffdf82.js";import{T as Ee,a as Re,b as Fe,c as he,d as v,e as Me}from"./TableRow-f242d18b.js";import{T as We}from"./Tooltip-bce4e40f.js";import{D as ve,a as fe}from"./DialogContent-6ac242f3.js";import{I as qe}from"./IconButton-7b3a7669.js";import{D as ge}from"./DialogActions-a72d04b3.js";import{u as Ae}from"./useDispatch-794f7d90.js";import"./index.esm-21a277c7.js";import"./Grid-40636f23.js";import"./useSlotProps-52eb16c2.js";import"./Link-71046a3e.js";import"./useControlled-ede9ea79.js";import"./ownerWindow-46c4bc4a.js";import"./clsx.m-1229b3e0.js";import"./InputAdornment-0f5deac7.js";import"./useFormControl-c4cdf3b7.js";import"./ListContext-24007cb6.js";import"./Modal-4ae20275.js";import"./Paper-73496770.js";import"./dividerClasses-1168dda4.js";import"./listItemTextClasses-201dc23b.js";import"./createStack-3bc4d5d9.js";import"./styled-071a7d88.js";Ve(r)(()=>({padding:"30px",transition:"0.1s ease-in",cursor:"pointer",color:"inherit","&:hover":{transform:"scale(1.03)"}}));var X={},He=ke;Object.defineProperty(X,"__esModule",{value:!0});var je=X.default=void 0,Ye=He(Be()),ze=e;je=X.default=(0,Ye.default)((0,ze.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"}),"Block");function Ge({billingLocation:s,setOpen1:o,mutate:a}){const c=Z(i=>i.novelprofileReducer.fullName),y=Z(i=>i.novelprofileReducer.userEmail),[h,f]=D.useState({customer:c,customerEmail:y,visitorName:"",vehicleNumber:"",vehicleType:"",visitorEmail:"",visitLocation:"",billingLead:s.length>0?s[0].leadId:"",billingLoc:s.length>0?s[0].location:"",visitingDate:le(),visitingTime:le()}),[j,u]=D.useState(!1),T=[{location:"Novel Office WorkHub - Whitefield"},{location:"Novel Office Brigade"},{location:"Novel Tech Park - Kudlu Gate"},{location:"Novel Office Brigade - Whitefield"},{location:"Novel Office Central - MG Road"},{location:"Novel Business Park - Adugodi"},{location:"Novel Office Marathahalli"},{location:"Novel Office Queens - Queens Road"}],k=[{type:"Car"},{type:"Bike"}],V=i=>$.success(i,{toastId:"success"}),w=i=>$.error(i,{toastId:"error"}),I=i=>$.warn(i,{toastId:"warn"}),_=i=>{f(n=>b(C({},n),{billingLead:i.leadId,billingLoc:i.location}))},l=i=>{const{name:n,value:x}=i.target;f(g=>b(C({},g),{[n]:x}))},W=i=>{const{value:n}=i.target;f(x=>b(C({},x),{visitLocation:n}))},p=i=>{const n=new Date(i),x=`${n.getDate()}-${n.getMonth()+1}-${n.getFullYear()}`;f(g=>b(C({},g),{visitingDate:x}))},E=i=>{const n=new Date(i),x=n.getHours(),g=n.getMinutes(),t=x>=12?"PM":"AM",B=`${x%12||12}:${g<10?"0":""}${g} ${t}`;f(N=>b(C({},N),{visitingTime:B}))},ee=()=>{u(!0);const{customer:i,customerEmail:n,visitorName:x,vehicleNumber:g,vehicleType:t,visitorEmail:d,visitLocation:B,billingLead:N,billingLoc:q,visitingDate:R,visitingTime:A}=h;if(!(i&&n&&x&&g&&t&&d&&B&&N&&q&&R&&A))I("Please fill in all the details"),u(!1);else{const S=new Date().getTime(),[H,te,be]=R.split("-");new Date(`${be}-${te}-${H}`).getTime()<=S?(I("Visiting date must be greater than the current date"),u(!1)):ue.post("/api/method/novelite.api.api.addDataToleadsAndVisitorParking",h).then(F=>{console.log(F),V("Booking successful"),setTimeout(()=>{u(!1),o(!1),a()},1e3)}).catch(F=>{w(F.message),u(!1),console.log(F)})}};return e.jsxs(r,{children:[e.jsxs(r,{noValidate:!0,component:"form",sx:{display:"flex",flexDirection:"column",m:"auto",width:"90%"},children:[e.jsxs(r,{children:[e.jsxs(z,{fullWidth:!0,variant:"standard",children:[e.jsx(G,{required:!0,id:"demo-simple-select-helper-label",children:"Billing Location"}),e.jsx(Q,{labelId:"demo-simple-select-helper-label",id:"demo-simple-select-helper",value:s.length>0?s[0]:"",label:"Billing Location",onChange:i=>_(i.target.value),disabled:s.length===1,children:s.map((i,n)=>e.jsx(K,{value:i,children:i.location},n))})]}),e.jsx(O,{label:"Your Email",variant:"standard",required:!0,style:{width:"100%",marginTop:"8px"},name:"customerEmail",value:h.customerEmail,onChange:l})]}),e.jsx(Pe,{}),e.jsx(J,{sx:{ml:"-2.2em",mb:"-1rem"},children:"Visitor Details"}),e.jsxs(r,{sx:{display:"flex",flexDirection:{xs:"column",md:"row",ls:"row"},gap:2},children:[e.jsxs(r,{children:[e.jsx(O,{label:"Visitor Name",variant:"standard",value:h.visitorName,onChange:l,required:!0,style:{width:"100%",marginTop:"16px"},name:"visitorName"}),e.jsx(O,{label:"Vehicle Number",variant:"standard",value:h.vehicleNumber,onChange:l,required:!0,style:{width:"100%",marginTop:"16px"},name:"vehicleNumber"})]}),e.jsxs(r,{children:[e.jsx(O,{label:"Visitor Email",variant:"standard",value:h.visitorEmail,onChange:l,required:!0,style:{width:"100%",marginTop:"16px"},name:"visitorEmail"}),e.jsxs(z,{variant:"standard",fullWidth:!0,sx:{mt:2},children:[e.jsx(G,{id:"visit-location-label",children:"Visit Location"}),e.jsx(Q,{labelId:"visit-location-label",id:"visit-location-select",value:h.visitLocation,label:"Visit Location",onChange:W,children:T.map(i=>e.jsx(K,{value:i.location,children:i.location},i.location))})]})]})]}),e.jsxs(z,{variant:"standard",fullWidth:!0,sx:{mt:2},children:[e.jsx(G,{id:"vehicle-type-label",children:"Vehicle Type"}),e.jsx(Q,{labelId:"vehicle-type-label",id:"vehicle-type-select",value:h.vehicleType,label:"Vehicle Type",name:"vehicleType",onChange:l,children:k.map(i=>e.jsx(K,{value:i.type,children:i.type},i.type))})]}),e.jsxs(r,{sx:{display:"flex",flexDirection:{xs:"column",md:"row",ls:"row"},justifyContent:"space-between",gap:2,mt:2},children:[e.jsx(r,{children:e.jsx(ce,{dateAdapter:de,children:e.jsx(me,{components:["TimeField","TimeField","TimeField"],children:e.jsx(Ne,{label:"Format with meridiem",defaultValue:h.visitingDate,format:"hh:mm a",onChange:i=>{E(i.$d)}})})})}),e.jsx(r,{children:e.jsx(ce,{dateAdapter:de,children:e.jsx(me,{components:["DateField","DateField"],children:e.jsx(Se,{label:"Dash separator",defaultValue:h.visitingDate,format:"DD-MM-YYYY",onChange:i=>p(i.$d)})})})})]}),e.jsx(L,{variant:"contained",sx:{mt:2},onClick:ee,disabled:j,children:j?e.jsx(xe,{color:"inherit",size:26}):"Submit"})]}),e.jsx(pe,{position:"top-center",autoClose:1e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"})]})}const Qe=()=>{Ae();const[s,o]=D.useState(0),[a,c]=D.useState(""),y=Z(t=>t.novelprofileReducer.companyName),f=(()=>{const{data:t}=Ie("Customer",`${y}`);return t==null?void 0:t.leads.map(d=>({location:d.confirmed_location,leadId:d.leads}))})(),[j,u]=D.useState(!1),T=()=>{u(!0)},k=()=>{u(!1)},[V,w]=D.useState(!1),[I,_]=D.useState(""),l=t=>{_(t),w(!0)},W=()=>{w(!1)},{data:p,mutate:E,isLoading:ee}=we("Visitor Parking Pass",{fields:["name","visitor_name","vehicle_type","visit_location","visitor_email","vehicle_no","visit_date","visit_time"],filters:[["customer","=",y]],limit_start:s,orderBy:{field:"creation",order:"desc"}}),i=Math.ceil((p==null?void 0:p.length)/10)||1,n=(t,d)=>{d=d-1,o(d*10)},x=(t,d)=>{const B=new Date,[N,q,R]=t.split("-").map(Number),[A,ie]=d.split(" ");let[S,H]=A.split(":").map(Number);return ie==="PM"&&S!==12&&(S+=12),new Date(N,q-1,R,S,H)<B},g=p==null?void 0:p.filter(t=>{var d;return(d=t.visitor_name)==null?void 0:d.toLowerCase().includes(a==null?void 0:a.toLowerCase())});if(p)return e.jsxs(r,{mt:4,children:[p.length===0&&e.jsxs(U,{alignItems:"center",justifyContent:"center",p:4,children:[e.jsx(m,{variant:"h4",pb:2,children:"There are no Records to show"}),e.jsx(r,{children:e.jsx(L,{variant:"contained",onClick:T,children:"Book parking pass"})})]}),p.length!==0&&e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{children:e.jsx(L,{variant:"contained",onClick:T,children:"Book parking pass"})}),e.jsx(r,{sx:{maxWidth:"100px",ml:"auto"},children:e.jsx(O,{size:"small",label:"Search",fullWidth:!0,value:a,onChange:t=>c(t.target.value)})})]}),p.length!==0&&e.jsx(Ee,{children:e.jsxs(Re,{children:[e.jsx(Fe,{children:e.jsxs(he,{children:[e.jsx(v,{children:e.jsx(m,{variant:"h6",children:"Visitor Name"})}),e.jsx(v,{children:e.jsx(m,{variant:"h6",children:"Visit Date"})}),e.jsx(v,{children:e.jsx(m,{variant:"h6",children:"Visit Time"})}),e.jsx(v,{children:e.jsx(m,{variant:"h6",children:"Visitor Vehicle No"})}),e.jsx(v,{children:e.jsx(m,{variant:"h6",children:"Visitor Location"})}),e.jsx(v,{align:"center",children:e.jsx(m,{variant:"h6",children:"Action"})})]})}),g&&e.jsx(Me,{children:g.map(t=>e.jsxs(he,{hover:!0,children:[e.jsx(v,{component:P,to:`/visit_details/${t.name}`,children:e.jsx(m,{variant:"h6",children:t.visitor_name})}),e.jsx(v,{component:P,to:`/visit_details/${t.name}`,children:e.jsxs(r,{children:[e.jsx(m,{variant:"h6",fontWeight:"500",noWrap:!0,children:t.visit_date}),e.jsx(m,{color:"textSecondary",noWrap:!0,sx:{maxWidth:"250px"},variant:"subtitle2",fontWeight:"400",children:t.visit_time})]})}),e.jsx(v,{component:P,to:`/visit_details/${t.name}`,children:e.jsx(U,{direction:"row",gap:"10px",alignItems:"center",children:e.jsx(m,{variant:"h6",children:t.visit_time})})}),e.jsx(v,{component:P,to:`/visit_details/${t.name}`,children:e.jsx(m,{children:t.vehicle_no})}),e.jsx(v,{component:P,to:`/visit_details/${t.name}`,children:e.jsx(m,{children:t.visit_location})}),e.jsx(v,{children:e.jsx(We,{title:"Cancel Booking",children:e.jsx(L,{color:"error",onClick:()=>l(t.name),disabled:x(t.visit_date,t.visit_time),children:x(t.visit_date,t.visit_time)?e.jsx(je,{}):"Cancel"})})})]},t.name))})]})}),p.length!==0&&e.jsx(r,{my:3,display:"flex",justifyContent:"center",children:e.jsx(Oe,{count:i,color:"primary",onChange:n})}),e.jsxs(ve,{fullWidth:!0,maxWidth:"sm",open:j,onClose:k,children:[e.jsx(J,{children:e.jsxs(U,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(m,{variant:"h5",children:"Book a pass"}),e.jsx(qe,{onClick:k,"aria-label":"close",children:e.jsx($e,{})})]})}),e.jsx(fe,{children:f&&e.jsx(Ge,{setOpen1:u,mutate:E,billingLocation:f})}),e.jsx(ge,{})]}),e.jsx(Ce,{id:"ringtone-menu",keepMounted:!0,open:V,mutate:E,onClose:W,visitorId:I})]})},Ke=Qe;function Ce(s){const _=s,{onClose:o,visitorId:a,open:c,mutate:y}=_,h=ne(_,["onClose","visitorId","open","mutate"]),f=re.useRef(null),[j,u]=re.useState(!1),T=l=>$.success(l,{toastId:"success"}),k=l=>$.error(l,{toastId:"error"}),V=()=>{f.current!=null&&f.current.focus()},w=()=>{o()},I=()=>{u(!0),a&&ue.post("/api/method/novelite.api.api.removeDataFromLeadsAndVisitorParking",{vps_id:a}).then(l=>{console.log(l),T("Booking Cancelled succesfully"),setTimeout(()=>{o(),y(),u(!1)},1e3)}).catch(l=>{k(l.message),u(!1),console.log(l)})};return e.jsxs(ve,b(C({sx:{"& .MuiDialog-paper":{width:"80%",maxHeight:435}},maxWidth:"xs",TransitionProps:{onEntering:V},open:c},h),{children:[e.jsx(J,{children:"Cancel Visitor parking pass?"}),e.jsx(fe,{dividers:!0,children:"Do you want to cancel Visitor parking pass?"}),e.jsxs(ge,{children:[!j&&e.jsx(L,{autoFocus:!0,onClick:w,children:"Cancel"}),e.jsx(L,{onClick:I,disabled:j,children:j?e.jsx(xe,{color:"inherit",size:24}):"Ok"})]}),e.jsx(pe,{position:"top-center",autoClose:1e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"})]}))}Ce.propTypes={onClose:Y.func.isRequired,open:Y.bool.isRequired,visitorId:Y.string.isRequired};const Ue=[{to:"/dashboard",title:"Home"},{title:"Visitor parking pass"}];function Ei(){return e.jsxs(Le,{title:"Visitor parking pass - Novel Office",description:"this is Sales Visitor parking pass page",children:[e.jsx(_e,{title:"Visitor parking pass",items:Ue}),e.jsx(Ke,{})]})}export{Ei as default};

var ht=Object.defineProperty,pt=Object.defineProperties;var ft=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var Ve=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var ze=(i,a,c)=>a in i?ht(i,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):i[a]=c,M=(i,a)=>{for(var c in a||(a={}))Ve.call(a,c)&&ze(i,c,a[c]);if(ve)for(var c of ve(a))qe.call(a,c)&&ze(i,c,a[c]);return i},$=(i,a)=>pt(i,ft(a));var Ge=(i,a)=>{var c={};for(var r in i)Ve.call(i,r)&&a.indexOf(r)<0&&(c[r]=i[r]);if(i!=null&&ve)for(var r of ve(i))a.indexOf(r)<0&&qe.call(i,r)&&(c[r]=i[r]);return c};import{r as l,y as xt,j as e,_ as Oe,d as q,al as be,am as Ne,Z as se,V as he,a as gt,A as jt,an as vt,ao as nt,ap as bt,af as Qe,aq as Nt,L as Ce,a9 as Ct,ar as yt,I as Pt}from"./index-8b3b8eba.js";import{B as Tt}from"./Breadcrumb-180b5288.js";import{P as wt}from"./PageContainer-d98636eb.js";import"./ChildCard-dd994321.js";import{B as P}from"./Box-399c9622.js";import{u as It,G as oe}from"./Grid-f4d7d3ed.js";import{e as kt,s as Be,T as x}from"./Typography-1427830e.js";import{u as De}from"./useDispatch-878c29d8.js";import{r as ae}from"./createSvgIcon-49cf013b.js";import{D as Se,d as Ue}from"./Close-15902f4f.js";import{k as it,Q as pe}from"./ReactToastify-98a908de.js";import{T as lt,t as _t}from"./Tooltip-9c6dfe3d.js";import{B as V}from"./Box-7c985c27.js";import{T as Ot,r as St,g as Ke}from"./Modal-06095198.js";import{F as ce,I as ue}from"./InputLabel-37dcdfba.js";import{S as de}from"./Select-3a5e17b2.js";import{M as me}from"./MenuItem-bddb5336.js";import{T as w}from"./TextField-3797edb5.js";import{S as Y}from"./Stack-6654f631.js";import{B as ee}from"./Button-8cc464ae.js";import{T as Rt,a as Bt,b as Dt,c as ye,d as _,e as Et,f as At,g as Ft,h as Ze,i as Je,j as Xe,k as Ye}from"./LastPage-294bbf53.js";import{P as Lt}from"./Paper-0f05f7b2.js";import{C as Mt}from"./Chip-8098c819.js";import{B as $t}from"./Badge-05dddda9.js";import{R as et}from"./Rating-536ea44c.js";import{D as tt,a as st}from"./DialogContent-1834dda8.js";import{I as te}from"./IconButton-101c88e4.js";import{D as at}from"./DialogActions-84780869.js";import{C as Ht}from"./CircularProgress-c9018ce5.js";import"./index-f9ed67d0.js";import"./index.esm-eaeab6e7.js";import"./useSlotProps-70f7ca87.js";import"./Link-52777340.js";import"./Card-db1260bf.js";import"./CardHeader-43943928.js";import"./Divider-15ff209d.js";import"./dividerClasses-27c89fbf.js";import"./CardContent-8f57d85d.js";import"./useControlled-a5c8634c.js";import"./ownerWindow-fbe9f185.js";import"./isMuiElement-107d3612.js";import"./Popper-726b155e.js";import"./ListContext-b8157264.js";import"./useFormControl-b611f770.js";import"./listItemTextClasses-4c972a14.js";import"./createStack-ee48abd7.js";import"./styled-533bb9dc.js";import"./KeyboardArrowRight-bc2722de.js";import"./Toolbar-44462387.js";import"./index-8886e64c.js";import"./visuallyHidden-fa9934b5.js";const Wt=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],zt={entering:{transform:"none"},entered:{transform:"none"}},Vt=l.forwardRef(function(a,c){const r=It(),g={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:j,appear:p=!0,children:o,easing:n,in:h,onEnter:f,onEntered:G,onEntering:A,onExit:Q,onExited:U,onExiting:K,style:O,timeout:F=g,TransitionComponent:re=Ot}=a,X=xt(a,Wt),S=l.useRef(null),ne=kt(S,o.ref,c),N=m=>C=>{if(m){const v=S.current;C===void 0?m(v):m(v,C)}},H=N(A),R=N((m,C)=>{St(m);const v=Ke({style:O,timeout:F,easing:n},{mode:"enter"});m.style.webkitTransition=r.transitions.create("transform",v),m.style.transition=r.transitions.create("transform",v),f&&f(m,C)}),B=N(G),W=N(K),D=N(m=>{const C=Ke({style:O,timeout:F,easing:n},{mode:"exit"});m.style.webkitTransition=r.transitions.create("transform",C),m.style.transition=r.transitions.create("transform",C),Q&&Q(m)}),Z=N(U),ie=m=>{j&&j(S.current,m)};return e.jsx(re,Oe({appear:p,in:h,nodeRef:S,onEnter:R,onEntered:B,onEntering:H,onExit:D,onExited:Z,onExiting:W,addEndListener:ie,timeout:F},X,{children:(m,C)=>l.cloneElement(o,Oe({style:Oe({transform:"scale(0)",visibility:m==="exited"&&!h?"hidden":void 0},zt[m],O,o.props.style),ref:ne},C))}))}),rt=Vt,Pe=Be(P)(()=>({padding:"30px",transition:"0.1s ease-in",cursor:"pointer",color:"inherit","&:hover":{transform:"scale(1.03)"}})),qt=({userEmail:i,filterLocation:a})=>{const c=De(),r=q(n=>n.ticketReducer.tickets);r&&r.filter(n=>n.status==="On Hold").length,r&&r.filter(n=>n.status==="Open").length,r&&r.filter(n=>n.status==="Closed").length;const g=()=>{const{data:n}=Ne("Issue",a==="ALL"?[["raised_by","=",i]]:[["raised_by","=",i],["location","=",a]],!1);return n||0},j=()=>{const{data:n}=Ne("Issue",a==="ALL"?[["status","=","Closed"],["raised_by","=",i]]:[["status","=","Closed"],["raised_by","=",i],["location","=",a]],!1);return n||0},p=()=>{const{data:n}=Ne("Issue",a==="ALL"?[["status","=","Pending"],["raised_by","=",i]]:[["status","=","Pending"],["raised_by","=",i],["location","=",a]],!1);return n||0},o=()=>{const{data:n}=Ne("Issue",a==="ALL"?[["status","=","In-Progress"],["raised_by","=",i]]:[["status","=","In-Progress"],["raised_by","=",i],["location","=",a]],!1);return n||0};return e.jsxs(oe,{container:!0,spacing:3,textAlign:"center",p:1,children:[e.jsx(oe,{item:!0,xs:6,sm:6,lg:3,children:e.jsxs(Pe,{onClick:o()!==0?()=>c(be("In-Progress")):void 0,sx:{backgroundColor:"success.light",color:"success.main",cursor:o()!==0?"pointer":"default"},children:[e.jsx(x,{variant:"h3",children:o()}),e.jsx(x,{variant:"h6",children:"In-Progress"})]})}),e.jsx(oe,{item:!0,xs:6,sm:6,lg:3,children:e.jsxs(Pe,{onClick:p()!==0?()=>c(be("Pending")):void 0,sx:{backgroundColor:"warning.light",color:"warning.main",cursor:p()!==0?"pointer":"default"},children:[e.jsx(x,{variant:"h3",children:p()}),e.jsx(x,{variant:"h6",children:"Pending"})]})}),e.jsx(oe,{item:!0,xs:6,sm:6,lg:3,children:e.jsxs(Pe,{onClick:j()!==0?()=>c(be("Closed")):void 0,sx:{backgroundColor:"error.light",color:"error.main",cursor:j()!==0?"pointer":"default"},children:[e.jsx(x,{variant:"h3",children:j()}),e.jsx(x,{variant:"h6",children:"Closed"})]})}),e.jsx(oe,{item:!0,xs:6,sm:6,lg:3,children:e.jsxs(Pe,{onClick:g()!==0?()=>c(be("total_tickets")):void 0,sx:{backgroundColor:"primary.light",color:"primary.main",cursor:g()!==0?"pointer":"default"},children:[e.jsx(x,{variant:"h3",children:g()}),e.jsx(x,{variant:"h6",children:"Total"})]})})]})},Gt=qt;var Ee={},Qt=se;Object.defineProperty(Ee,"__esModule",{value:!0});var ot=Ee.default=void 0,Ut=Qt(ae()),Kt=e;ot=Ee.default=(0,Ut.default)((0,Kt.jsx)("path",{d:"M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4zM20 4v13.17L18.83 16H4V4zM6 12h12v2H6zm0-3h12v2H6zm0-3h12v2H6z"}),"CommentOutlined");var Ae={},Zt=se;Object.defineProperty(Ae,"__esModule",{value:!0});var Re=Ae.default=void 0,Jt=Zt(ae()),Xt=e;Re=Ae.default=(0,Jt.default)((0,Xt.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");var Fe={},Yt=se;Object.defineProperty(Fe,"__esModule",{value:!0});var ct=Fe.default=void 0,es=Yt(ae()),ts=e;ct=Fe.default=(0,es.default)((0,ts.jsx)("path",{d:"M18.83 16H20V4H6.83l-2-2H20c1.1 0 2 .9 2 2v15.17zM18 6H8.83l2 2H18zm0 3h-6.17l2 2H18zm0 5v-2h-3.17l2 2zm3.9 7.9-1.41 1.41L15.17 18H4c-1.1 0-2-.9-2-2V4.83L.69 3.51 2.1 2.1zM13.17 16l-2-2H6v-2h3.17l-1-1H6V9h.17L4 6.83V16z"}),"CommentsDisabledOutlined");var Le={},ss=se;Object.defineProperty(Le,"__esModule",{value:!0});var ut=Le.default=void 0,as=ss(ae()),rs=e;ut=Le.default=(0,as.default)((0,rs.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"}),"Help");var Me={},ns=se;Object.defineProperty(Me,"__esModule",{value:!0});var dt=Me.default=void 0,is=ns(ae()),ls=e;dt=Me.default=(0,is.default)((0,ls.jsx)("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile");const os="/assets/novelite/client-dashboard/assets/AC Vent Number Identification-21869f60.jpg",cs=Be("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),us=Be(c=>{var r=c,{className:i}=r,a=Ge(r,["className"]);return e.jsx(lt,$(M({},a),{classes:{popper:i}}))})(({theme:i})=>({[`& .${_t.tooltip}`]:{color:"rgba(0, 0, 0, 0.87)",maxWidth:300,padding:"10px"}}));function ds({confirmedLocations:i,filterLocation:a,setFilterLocation:c,setOpen1:r,mutate:g,submitTicket:j,setShowLoading:p,issueTypesArray:o}){const n=De(),h=q(s=>s.novelprofileReducer.fullName);q(s=>s.novelprofileReducer.userEmail);const[f,G]=l.useState(null),[A,Q]=l.useState(!1),[U,K]=l.useState(!1),[O,F]=l.useState(!1),[re,X]=l.useState(!1),[S,ne]=l.useState(""),N=["High","Medium","Low"],[H,R]=l.useState(N[0]),[B,W]=l.useState({subject:"",description:"",location:localStorage.getItem("location")||a,issueType:"",issueSubType:"",contactName:"",contactNumber:"",alternateEmail:"",customer:h,email:"",file:"",fileName:"",ventNumber:"",creation_via:"Ticket",priority:H}),D=[{shortName:"NTP",fullName:"Novel Tech Park - Kudlu Gate"},{shortName:"NOM",fullName:"Novel Office Marathahalli"},{shortName:"NOC",fullName:"Novel Office Central - MG Road"},{shortName:"NOQ",fullName:"Novel Office Queens- Queens Road"},{shortName:"NOW",fullName:"Novel Office WorkHub- Whitefield"},{shortName:"NBP",fullName:"Novel Business Park - Adugodi"},{shortName:"NOB",fullName:"Novel Office Brigade"},{shortName:"BTP1F",fullName:"Novel Office Brigade-Whitefield"}];let Z={"IT and Network":["Internet not working | Slow Internet","LAN Port","LAN Cable","Patch Cord issue","Computer","Sytem/Desktop","EPAbx Setup","GSM Issue","Server","Other"],Parking:["Request Additional Parking","New Parking Sticker | New Parking User","P.S. Lost","Pay and Park","P.S. Downsize","Other"],"Security and Access":["Access card Damaged","Access card not working","Access card lost","New Access card","Temporary Access Cards","Other"],"Gate Pass":["MAF","Other"],"Documents and Accounts":["Rental Agreement","NOC","Utility Bill","Property Tax","Property Agreement","Other"],"Accounts and Billing":["Incorrect Invoice","Duplicate Charges","GST Inclusion","Unknown Charges","TDS","Credit Note","Other"],"House Keeping":["Cleaning Required","Foul Odour","Food Spill","Dust Bin Clearing","Cardboard Removal","Carpet Cleaning","Other"],"Office Space Modification":["Desk Expansion | Downsize","Chair Issues","Layout Change","Ammenities : Pedestal, Storage Box 4Ft & 6Ft, Frosting, White Board","Beading Issue","Sound Issue","Door Issues","Carpet Issues","Blinds Issue","Other"],"Restroom | Common Area":["Washroom","Cleaning","Tap Leakage","Tissue Paper Replacement","Foul Smell","Wet Floor","Soap Refill","Faucet Leak","Other"],AC:["Too Hot","Too Cold","AC not Working","Facade Area Issues","Other"],Electrical:["Light Not Working","Light Flickering","Dim Light Replacement","Power Socket Issue","Access Controller","Acess Controller repair","Elevator | Lift not working","Extra UPS | RAW Requirement","Emergency Light","Frequent Power Outage","Other"],"Meeting Room | Conference Room Booking":["Book Meeting  Room","Book Conference Room","Other"]};const[ie,m]=l.useState(["IT and Network","Parking","Security and Access","Gate Pass","Documents and Accounts","Accounts and Billing","House Keeping","Office Space Modification","Restroom | Common Area","AC","Electrical","Meeting Room | Conference Room Booking","Other"]),[C,v]=l.useState(ie[0]);l.useState(Z[C]?Z[C][0]:""),l.useState(Z[C]||[]);const He=q(s=>s.ticketReducer.issueType),[T,le]=l.useState(He),[b,Te]=l.useState(""),J=l.useRef(!0);l.useEffect(()=>{W(s=>$(M({},s),{subject:`${T} - ${b}`}))},[T,b]),l.useEffect(()=>{J.current?J.current=!1:_e()},[j]);let{data:I}=he("Issue SubType",{fields:["name","issue_type"],filters:[["issue_type","in",`${T}, Other`]],orderBy:{field:"name",order:"asc"}});if(I){const s=I.filter(t=>t.name==="Other");I=[...I.filter(t=>t.name!=="Other"),...s]}const fe=s=>{const d=s.target.value;n(nt(d)),le(d)},xe=s=>{const d=s.target.value;Te(d)},y=s=>{const{name:d,value:t}=s.target;we(d,t)},we=(s,d)=>{W(t=>$(M({},t),{[s]:d}))};gt();const Ie=s=>pe.success(s,{toastId:"success"}),We=s=>pe.error(s,{toastId:"error"}),L=s=>pe.warn(s,{toastId:"warn"}),ke=s=>{const{name:d,value:t}=s.target;W(u=>$(M({},u),{[d]:t}))},ge=s=>{if(s){if(s.size>5242880)return!0}else return!1;const d=s.name.split(".").pop().toLowerCase();return!["pdf","png","jpg","mp4"].includes(d)},_e=()=>{const s=$(M({},B),{issueType:T,issueSubType:b});if(K(!1),p(!0),F(!1),X(!1),S===""){L("Please Select the location"),p(!1);return}if((T==="Other"||b.includes("Other"))&&s.subject===""){L("Please fill the ticket title"),p(!1);return}if(T!=="Other"&&b===""){L("Please select issue sub type"),p(!1);return}if(s.contactName==="")L("Please fill the contact Name"),K(!0),p(!1);else if(s.contactNumber==="")L("Please fill the contact Number"),F(!0),p(!1);else if(s.email==="")L("Please fill the email id"),X(!0),p(!1);else if(s.contactNumber.length>10)L("Please enter only 10 numbers"),p(!1);else if(ge(f))L("File size cannot be more than 5MB and must be in PDF, PNG, JPG, or MP4 format"),p(!1);else{p(!0);const d=$(M({},B),{issueType:T,issueSubType:b}),t={subject:d.subject,description:d.description,location:S,issue_type:d.issueType,custom_issue_subtype:d.issueSubType,contact_name:d.contactName,contact_phone:d.contactNumber,contact_email:d.email,contact_email_alternative:d.alternateEmail,customer:h,vent_number:d.ventNumber,priority:H,creation_via:"Ticket"};if(f){const u=new FileReader;u.readAsDataURL(f),u.onloadend=function(){const z=u.result;t.file=z,t.fileName=f.name.split(".")[0],je(t)}}else je(t),console.log("ticket details = ",t),p(!1)}},je=s=>{jt.post("/api/method/novelite.api.api.issue",s).then(d=>{console.log("Response = ",d),Ie("Ticket created Successfully"),setTimeout(()=>{p(!1),r(!1),g()},1e3)}).catch(d=>{console.log("inside catch "+JSON.stringify(d.message)),p(!1),We(d.message)})};return e.jsxs(e.Fragment,{children:[e.jsxs(V,{noValidate:!0,component:"form",sx:{display:"flex",flexDirection:"column",m:"auto",width:"90%"},children:[e.jsx(lt,{disableFocusListener:!0,disableTouchListener:!0,placement:"top",TransitionComponent:rt,title:"Property for which you want to rise ticket",children:e.jsx(V,{children:e.jsxs(ce,{fullWidth:!0,sx:{mt:2},children:[e.jsx(ue,{id:"demo-simple-select-label",children:"Property Location"}),e.jsx(de,{labelId:"demo-simple-select-label",id:"demo-simple-select",label:"Property Location",onChange:s=>{ne(s.target.value)},children:D==null?void 0:D.map(s=>e.jsx(me,{value:s.shortName,children:s.fullName},s.shortName))})]})})}),e.jsxs(ce,{fullWidth:!0,sx:{mt:2},children:[e.jsx(ue,{children:"Issue type"}),e.jsx(de,{label:"Issue type",value:T,onChange:fe,children:o==null?void 0:o.map(s=>e.jsx(me,{value:s.name,children:s.name},s.name))})]}),T!=="Other"&&e.jsxs(ce,{fullWidth:!0,sx:{mt:2},children:[e.jsx(ue,{children:"Issue sub type"}),e.jsx(de,{label:"Issue sub type",onChange:xe,children:I&&(I==null?void 0:I.map(s=>e.jsx(me,{value:s.name,children:s.name},s.name)))})]}),T==="Other"||b.includes("Other")?e.jsx(w,{label:"Ticket Title",variant:"standard",sx:{width:"100%",mt:2,ml:1},name:"subject",value:B.subject,onChange:y}):null,T==="AC"?e.jsxs(Y,{sx:{mt:1},justifyContent:"end",alignItems:"center",flexDirection:"row",children:[e.jsx(w,{label:"Vent number",name:"ventNumber",variant:"standard",sx:{width:"100%",mt:2,ml:1},onChange:y}),e.jsx(us,{placement:"left",TransitionComponent:rt,sx:{transform:"translate(-14px, 51px)"},PopperProps:{disablePortal:!0},onClose:()=>{Q(vt.stubFalse)},open:A,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,title:e.jsxs(e.Fragment,{children:[e.jsx("img",{src:os,width:"100%",alt:"img"}),e.jsx(x,{variant:"p",children:"AC vent Number"})]}),children:e.jsx(ut,{onClick:()=>{Q(!A)},sx:{mb:"-2rem"}})})]}):null,e.jsx(V,{sx:{mt:2},children:e.jsx(w,{id:"outlined-multiline-static",label:"Ticket Description",multiline:!0,rows:2,style:{width:"100%"},name:"description",value:B.description,onChange:ke})}),e.jsxs(ce,{fullWidth:!0,sx:{mt:2},children:[e.jsx(ue,{children:"Priority"}),e.jsx(de,{label:"Priority",value:H,onChange:s=>{R(s.target.value)},children:N==null?void 0:N.map(s=>e.jsx(me,{value:s,children:s},s))})]}),e.jsxs(V,{mt:2,sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexDirection:{xs:"column",md:"row",ls:"row"},gap:2},children:[e.jsxs(ee,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,startIcon:e.jsx(dt,{}),children:["Attach file",e.jsx(cs,{type:"file",onChange:s=>G(s.target.files[0])})]}),f&&e.jsx(x,{variant:"p",children:f.name})]}),e.jsx(Se,{sx:{ml:"-2.2em",mb:"-1rem"},children:"Contact Details"}),e.jsxs(V,{sx:{display:"flex",flexDirection:{xs:"column",md:"row",ls:"row"},gap:2},children:[e.jsxs(V,{children:[U?e.jsx(w,{error:!0,label:"Contact Name",variant:"standard",required:!0,style:{width:"100%",marginTop:"16px"},name:"contactName",onChange:y}):e.jsx(w,{label:"Contact Name",variant:"standard",required:!0,style:{width:"100%",marginTop:"16px"},name:"contactName",onChange:y}),O?e.jsx(w,{error:!0,label:"Contact Number",variant:"standard",required:!0,style:{width:"100%",marginTop:"16px"},name:"contactNumber",onChange:y}):e.jsx(w,{label:"Contact Number",variant:"standard",required:!0,style:{width:"100%",marginTop:"16px"},name:"contactNumber",onChange:y})]}),e.jsxs(V,{children:[re?e.jsx(w,{label:"Email",error:!0,required:!0,variant:"standard",style:{width:"100%",marginTop:"16px"},name:"email",value:B.email,onChange:y}):e.jsx(w,{label:"Email",required:!0,variant:"standard",style:{width:"100%",marginTop:"16px"},name:"email",value:B.email,onChange:y}),e.jsx(w,{label:"Alternate Email (Optional)",variant:"standard",style:{width:"100%",marginTop:"16px"},name:"alternateEmail",onChange:y})]})]})]}),e.jsx(it,{position:"top-center",autoClose:1e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"})]})}var $e={},ms=se;Object.defineProperty($e,"__esModule",{value:!0});var mt=$e.default=void 0,hs=ms(ae()),ps=e;mt=$e.default=(0,hs.default)((0,ps.jsx)("path",{d:"m12 8.89.94 3.11h2.82l-2.27 1.62.93 3.01L12 14.79l-2.42 1.84.93-3.01L8.24 12h2.82zM12 2l-2.42 8H2l6.17 4.41L5.83 22 12 17.31 18.18 22l-2.35-7.59L22 10h-7.58z"}),"StarBorderPurple500");const fs="/assets/novelite/client-dashboard/assets/SuccessSound-651080b1.wav",xs=({userEmail:i,confirmedLocations:a,setFilterLocation:c,filterLocation:r,unReadMessages:g})=>{var d;const j=De(),[p,o]=l.useState(!1),[n,h]=l.useState(!1);l.useState(!1);const[f,G]=l.useState(!1),[A,Q]=l.useState(!1),[U,K]=l.useState(0),[O,F]=l.useState(0),[re,X]=l.useState(""),[S,ne]=l.useState(""),[N,H]=l.useState(0),[R,B]=l.useState(5),W=l.useRef(!0),D=l.useRef(null),Z=t=>pe.success(t,{toastId:"success"}),ie=t=>pe.error(t,{toastId:"error"}),{data:m}=he("Issue",{fields:["subject","creation","status","raised_by","name","description","review_show_popup","rating"],filters:[["raised_by","=",i],["status","=","Closed"]],limit_start:0,limit:1,orderBy:{field:"modified",order:"desc"}});l.useEffect(()=>{W.current?W.current=!1:(m==null?void 0:m.length)>0&&(console.log("closedTicketData = ",m),m[0].review_show_popup===0&&(F(m[0].name),xe(m[0].name,m[0].subject),D==null||D.current.play()))},[m]);const C=t=>{let u=t.target.value;c(u),j(yt(u)),console.log("Location = ",u),t.target.value!=="Property Location"&&localStorage.setItem("location",u),le()};let{data:v,error:He,isValidating:T,mutate:le}=he("Issue",{fields:["subject","creation","status","raised_by","name","description","review_show_popup","location","rating"],filters:r==="ALL"?[["raised_by","=",i]]:[["raised_by","=",i],["location","=",r]],limit_start:0,limit:1e5,orderBy:{field:"creation",order:"desc"}});var b=[];v&&(b=v.map(t=>{console.log("unReadMessages = ",g);const u=g==null?void 0:g.find(z=>z.ticket_id===t.name);return u?$(M({},t),{unread_messages:u.unread_messages}):$(M({},t),{unread_messages:0})}),j(bt(v)));const{updateDoc:Te}=Qe(),{data:J}=he("Issue Type",{fields:["name"],orderBy:{field:"name",order:"asc"}});J&&j(nt(J[0].name));const I=()=>{o(!0),G(!1)},fe=()=>{o(!1)},xe=(t,u)=>{h(!0),F(t),K(0),X(u)},y=()=>{h(!1),O&&Te("Issue",O,{review_show_popup:1}).then(t=>{console.log("review_show_popup updated to 1")}).catch(t=>{console.log(t)})},we=()=>{G(!f)},{updateDoc:Ie,loading:We,isCompleted:L}=Qe(),ke=()=>{Ie("Issue",O,{rating:U,rating_description:S,review_show_popup:1}).then(t=>{Z("Rated Successfully"),console.log(t),setTimeout(()=>{y(),le()},2e3)}).catch(t=>{console.log(t),ie(t)})},ge=N>0?Math.max(0,(1+N)*R-(b==null?void 0:b.length)):0,_e=(t,u)=>{H(u)},je=t=>{B(parseInt(t.target.value,10)),H(0)},s=(t,u,z)=>{if(t!=null)switch(u){case"total_tickets":return t.filter(E=>{var k;return(k=E.subject)==null?void 0:k.toLocaleLowerCase().includes(z)});case"Pending":return t.filter(E=>{var k;return E.status==="Pending"&&((k=E.subject)==null?void 0:k.toLocaleLowerCase().includes(z))});case"Closed":return t.filter(E=>{var k;return E.status==="Closed"&&((k=E.subject)==null?void 0:k.toLocaleLowerCase().includes(z))});case"In-Progress":return t.filter(E=>{var k;return E.status==="In-Progress"&&((k=E.subject)==null?void 0:k.toLocaleLowerCase().includes(z))});default:throw new Error(`Unknown filter: ${u}`)}};if(b!=null&&(b=q(t=>s(t.ticketReducer.tickets,t.ticketReducer.currentFilter,t.ticketReducer.ticketSearch))),v)return e.jsxs(P,{mt:4,children:[e.jsx(P,{display:"flex",justifyContent:{xs:"center",md:"end",ls:"end"},alignItems:"center",children:e.jsx(P,{sx:{mb:2},children:(a==null?void 0:a.length)>=2?e.jsxs(ce,{sx:{m:1,minWidth:170},children:[e.jsx(ue,{id:"demo-simple-select-autowidth-label",children:"Property Location"}),e.jsx(de,{labelId:"demo-simple-select-autowidth-label",id:"demo-simple-select-autowidth",value:r,label:"Property Location",onChange:C,children:a==null?void 0:a.map((t,u)=>e.jsx(me,{value:t.shortName,children:t.fullName},t.shortName+u))})]}):e.jsx(x,{variant:"h4",children:"This customer is not linked to any Location"})})}),v.length===0&&e.jsxs(Y,{alignItems:"center",justifyContent:"center",p:4,children:[e.jsx(x,{variant:"h4",pb:2,children:"There are no tickets"}),e.jsxs(ee,{variant:"contained",onClick:I,sx:{ml:1},children:["New  ",e.jsx(Re,{})]})]}),v.length!==0&&e.jsxs(P,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(P,{children:e.jsxs(ee,{variant:"contained",onClick:I,sx:{ml:1},children:["New  ",e.jsx(Re,{})]})}),e.jsx(P,{sx:{ml:"auto",width:{xs:"8rem",md:"12rem",ls:"12rem"}},display:"flex",justifyContent:"space-between",alignItems:"center",children:e.jsx(w,{size:"small",label:"Search",onChange:t=>j(Nt(t.target.value))})})]}),(v==null?void 0:v.length)!==0&&e.jsx(Lt,{variant:"outlined",sx:{mt:2},children:e.jsx(Rt,{children:e.jsxs(Bt,{"aria-label":"custom sales invoice",sx:{whiteSpace:"nowrap"},children:[e.jsx(Dt,{children:e.jsxs(ye,{children:[e.jsx(_,{children:e.jsx(x,{variant:"h6",children:"Ticket ID"})}),e.jsx(_,{children:e.jsx(x,{variant:"h6",children:"Ticket Name"})}),e.jsx(_,{children:e.jsx(x,{variant:"h6",children:"Status"})}),e.jsx(_,{children:e.jsx(x,{variant:"h6",children:"Chat"})}),e.jsx(_,{children:e.jsx(x,{variant:"h6",children:"Rating"})})]})}),e.jsxs(Et,{children:[(d=R>0?b==null?void 0:b.slice(N*R,N*R+R):b)==null?void 0:d.map(t=>e.jsxs(ye,{hover:!0,children:[e.jsx(_,{component:Ce,to:`/ticket_details/${t.name}`,children:e.jsx(P,{children:e.jsx(x,{variant:"h6",fontWeight:"500",wrap:!0,children:t.name})})}),e.jsx(_,{component:Ce,to:`/ticket_details/${t.name}`,children:e.jsx(P,{children:e.jsxs(x,{variant:"h6",fontWeight:"500",wrap:!0,children:[t.subject.slice(0,30),"..."]})})}),e.jsx(_,{component:Ce,to:`/ticket_details/${t.name}`,children:e.jsx(Mt,{sx:{backgroundColor:t.status==="In-Progress"?u=>u.palette.success.light:t.status==="Closed"?u=>u.palette.error.light:t.status==="Pending"?u=>u.palette.warning.light:t.status==="Re-Open"?u=>u.palette.primary.light:t.status==="Re-Open"},size:"small",label:t.status})}),e.jsx(_,{component:Ce,to:`/ticket_details/${t.name}`,children:t.status==="Closed"?e.jsx(ct,{}):e.jsx($t,{color:"secondary",badgeContent:t.unread_messages,children:e.jsx(ot,{})})}),e.jsx(_,{children:t.rating>0?e.jsx(et,{name:"read-only size-small",value:t.rating,size:"small",readOnly:!0}):e.jsx(ee,{variant:"outlined",disabled:t.status!=="Closed",onClick:()=>{xe(t.name,t.subject)},children:e.jsxs(Y,{flexDirection:"row",alignItems:"center",gap:.5,children:["Rate  ",e.jsx(mt,{})]})})})]},t.name)),ge>0&&e.jsx(ye,{style:{height:53*ge},children:e.jsx(_,{colSpan:6})})]}),e.jsx(At,{children:e.jsx(ye,{children:e.jsx(Ft,{rowsPerPageOptions:[5,10,25,{label:"All",value:-1}],colSpan:6,count:v==null?void 0:v.length,rowsPerPage:R,page:N,SelectProps:{inputprops:{"aria-label":"rows per page"},native:!0},onPageChange:_e,onRowsPerPageChange:je,ActionsComponent:js})})})]})})}),e.jsxs(tt,{fullWidth:!0,maxWidth:"sm",open:p,onClose:fe,children:[e.jsx(Se,{children:e.jsxs(Y,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(x,{variant:"h5",children:"Raise a Ticket"}),e.jsx(te,{onClick:fe,"aria-label":"close",children:e.jsx(Ue,{})})]})}),e.jsx(st,{children:J&&e.jsx(ds,{confirmedLocations:a,filterLocation:r,setFilterLocation:c,setOpen1:o,mutate:le,submitTicket:f,setShowLoading:Q,issueTypesArray:J})}),e.jsx(at,{children:e.jsx(P,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"100%",p:1,children:e.jsx(ee,{variant:"contained",onClick:we,disabled:(a==null?void 0:a.length)===1||A,children:A?e.jsx(Ht,{color:"inherit",size:26}):"Submit"})})})]}),e.jsxs(tt,{fullWidth:!0,maxWidth:"sm",open:n,onClose:y,children:[e.jsx(Se,{children:e.jsxs(Y,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(x,{variant:"h5",children:O}),e.jsx(te,{onClick:y,"aria-label":"close",children:e.jsx(Ue,{})})]})}),e.jsxs(st,{children:[e.jsx(it,{position:"top-center",autoClose:1e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"}),e.jsxs(Y,{children:[e.jsx(x,{variant:"p",pb:2,children:re}),e.jsx(et,{name:"simple-controlled",value:U,onChange:(t,u)=>{K(u)}}),e.jsx(P,{sx:{mt:2},children:e.jsx(w,{id:"outlined-multiline-static",label:"Feedback",multiline:!0,rows:2,style:{width:"100%"},name:"description",value:S,onChange:t=>{ne(t.target.value)}})})]})]}),e.jsx(at,{children:e.jsx(P,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"100%",p:1,children:e.jsx(ee,{variant:"outlined",onClick:ke,disabled:U===0,children:"Submit"})})})]}),e.jsx("audio",{ref:D,src:fs})]})},gs=xs;function js(i){const a=Ct(),{count:c,page:r,rowsPerPage:g,onPageChange:j}=i,p=f=>{j(f,0)},o=f=>{j(f,r-1)},n=f=>{j(f,r+1)},h=f=>{j(f,Math.max(0,Math.ceil(c/g)-1))};return e.jsxs(P,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(te,{onClick:p,disabled:r===0,"aria-label":"first page",children:a.direction==="rtl"?e.jsx(Ze,{}):e.jsx(Je,{})}),e.jsx(te,{onClick:o,disabled:r===0,"aria-label":"previous page",children:a.direction==="rtl"?e.jsx(Xe,{}):e.jsx(Ye,{})}),e.jsx(te,{onClick:n,disabled:r>=Math.ceil(c/g)-1,"aria-label":"next page",children:a.direction==="rtl"?e.jsx(Ye,{}):e.jsx(Xe,{})}),e.jsx(te,{onClick:h,disabled:r>=Math.ceil(c/g)-1,"aria-label":"last page",children:a.direction==="rtl"?e.jsx(Je,{}):e.jsx(Ze,{})})]})}const vs=[{to:"/dashboard",title:"Home"},{title:"Tickets"}];function ja(){const i=q(n=>n.novelprofileReducer.userEmail),a=q(n=>n.novelprofileReducer.location),c=q(n=>n.novelprofileReducer.companyName),[r,g]=l.useState(a);l.useEffect(()=>{let n=localStorage.getItem("location");n!=="Property Location"&&g(n)},[a,g]);const{data:j}=he("Issue Comment For Client",{fields:["ticket_id","unread_messages"],orderBy:{field:"modified",order:"desc"}});console.log("unReadMessages = ",j);var o=(()=>{const{data:n,error:h,isValidating:f,mutate:G}=Pt("Customer",`${c}`);return n==null?void 0:n.leads.map(A=>A.confirmed_location)})();return o&&(r===null&&g("ALL"),o=o==null?void 0:o.map(h=>{switch(h){case"NTP":return{shortName:h,fullName:"Novel Tech Park - Kudlu Gate"};case"NOM":return{shortName:h,fullName:"Novel Office Marathahalli"};case"NOC":return{shortName:h,fullName:"Novel Office Central - MG Road"};case"NOQ":return{shortName:h,fullName:"Novel Office Queens- Queens Road"};case"NOW":return{shortName:h,fullName:"Novel Office WorkHub- Whitefield"};case"NBP":return{shortName:h,fullName:"Novel Business Park - Adugodi"};case"NOB":return{shortName:h,fullName:"Novel Office Brigade"};case"BTP1F":return{shortName:h,fullName:"Novel Office Brigade-Whitefield"};case"BTP3F":return{shortName:h,fullName:"Novel Office Brigade-Whitefield"};default:return{shortName:h,fullName:h}}}),o==null||o.unshift({shortName:"ALL",fullName:"ALL"}),[{shortName:"NTP",fullName:"Novel Tech Park - Kudlu Gate"},{shortName:"NOM",fullName:"Novel Office Marathahalli"},{shortName:"NOC",fullName:"Novel Office Central - MG Road"},{shortName:"NOQ",fullName:"Novel Office Queens- Queens Road"},{shortName:"NOW",fullName:"Novel Office WorkHub- Whitefield"},{shortName:"NBP",fullName:"Novel Business Park - Adugodi"},{shortName:"NOB",fullName:"Novel Office Brigade"},{shortName:"BTP1F",fullName:"Novel Office Brigade-Whitefield"}].forEach(h=>{o!=null&&o.some(f=>f.shortName===h.shortName)||o==null||o.push(h)})),e.jsxs(wt,{title:"Tickets - Novel Office",description:"this is Note page",children:[e.jsx(Tt,{title:"Tickets",items:vs}),e.jsxs(V,{children:[e.jsx(Gt,{userEmail:i,filterLocation:r}),e.jsx(gs,{userEmail:i,filterLocation:r,unReadMessages:j,setFilterLocation:g,confirmedLocations:o})]})]})}export{ja as default};

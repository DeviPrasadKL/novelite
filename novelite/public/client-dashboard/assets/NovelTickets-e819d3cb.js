var ge=Object.defineProperty;var Z=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var J=(l,i,s)=>i in l?ge(l,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[i]=s,w=(l,i)=>{for(var s in i||(i={}))ve.call(i,s)&&J(l,s,i[s]);if(Z)for(var s of Z(i))be.call(i,s)&&J(l,s,i[s]);return l};import{e as b,j as e,av as T,c8 as N,r as m,c2 as Ce,c9 as ye,bV as Ne,at as Te,L as ke,ca as _e,bZ as Oe}from"./index-4c0b60c1.js";import{B as Se}from"./Breadcrumb-993a2ffd.js";import{P as we}from"./PageContainer-1e378f9f.js";import{C as Ie}from"./ChildCard-1408395c.js";import{B as c}from"./Box-62c7ea08.js";import{G as y}from"./Grid-858c8d28.js";import{s as De,T as o}from"./Typography-d41e00bf.js";import{u as re}from"./useDispatch-cfa82895.js";import{r as D,i as P}from"./createSvgIcon-232aa521.js";import{k as Pe,Q as K}from"./ReactToastify-7b7ec94e.js";import{F as U}from"./FormControl-05733a9f.js";import{I as E}from"./InputLabel-60b08834.js";import{S as X}from"./Select-fa541a15.js";import{M as Y}from"./MenuItem-9cba98ac.js";import{B as k}from"./Button-7b1b6ba5.js";import{T as I}from"./TextField-2386fcf6.js";import{T as Be,a as Re,b as Le,c as ee,d as g,e as $e}from"./TableRow-6d6d2972.js";import{C as He}from"./Chip-f7c4e200.js";import{B as te}from"./Badge-4cd6d0fa.js";import{P as Ae}from"./Pagination-67968815.js";import{M as Me}from"./Modal-e69de70e.js";import{D as se}from"./DialogActions-272f4a79.js";import{D as We,a as Ve}from"./DialogContent-233c028d.js";import{D as Fe}from"./DialogTitle-69aed3bd.js";import{T as ze}from"./Tooltip-69505884.js";import{Z as qe}from"./Zoom-29a9f604.js";import"./index.esm-ab86738a.js";import"./Link-600c6b92.js";import"./Card-93702703.js";import"./CardHeader-c9fcc5f5.js";import"./Divider-1c3d9281.js";import"./dividerClasses-4698ac49.js";import"./CardContent-3ef2c0f8.js";import"./createChainedFunction-0bab83cf.js";import"./ownerWindow-698471fc.js";import"./ownerDocument-613eb639.js";import"./isMuiElement-06cc0e9d.js";import"./useId-ab6b636f.js";import"./useControlled-aa938a2a.js";import"./clsx.m-1229b3e0.js";import"./utils-5ebfb48b.js";import"./useFormControl-4a8d5a10.js";import"./formControlState-02eb4045.js";import"./Popover-78ca825b.js";import"./Grow-34c80021.js";import"./utils-7ef43b08.js";import"./List-14aaf110.js";import"./ListContext-73043c56.js";import"./InputBase-e88cc6c4.js";import"./listItemIconClasses-9b443d96.js";import"./listItemTextClasses-35935c78.js";import"./usePreviousProps-a9d4c058.js";import"./LastPage-c5cd4655.js";import"./Fade-11f6ebc6.js";import"./Portal-a2e45162.js";import"./Popper-e9889bc7.js";import"./createPopper-319e19c4.js";const _=De(c)(()=>({padding:"30px",transition:"0.1s ease-in",cursor:"pointer",color:"inherit","&:hover":{transform:"scale(1.03)"}})),Ge=({userEmail:l,filterLocation:i})=>{const s=re(),d=b(r=>r.ticketReducer.tickets);d&&d.filter(r=>r.status==="On Hold").length,d&&d.filter(r=>r.status==="Open").length,d&&d.filter(r=>r.status==="Closed").length;const h=()=>{const{data:r}=N("Issue",i==="ALL"?[["raised_by","=",l]]:[["raised_by","=",l],["location","=",i]],!1);return r||0},j=()=>{const{data:r}=N("Issue",i==="ALL"?[["status","=","closed"],["raised_by","=",l]]:[["status","=","closed"],["raised_by","=",l],["location","=",i]],!1);return r||0},v=()=>{const{data:r}=N("Issue",i==="ALL"?[["status","=","on hold"],["raised_by","=",l]]:[["status","=","on hold"],["raised_by","=",l],["location","=",i]],!1);return r||0},f=()=>{const{data:r}=N("Issue",i==="ALL"?[["status","=","open"],["raised_by","=",l]]:[["status","=","open"],["raised_by","=",l],["location","=",i]],!1);return r||0};return e.jsxs(y,{container:!0,spacing:3,textAlign:"center",children:[e.jsx(y,{item:!0,xs:6,sm:6,lg:3,children:e.jsxs(_,{onClick:f()!==0?()=>s(T("Open")):void 0,sx:{backgroundColor:"success.light",color:"success.main"},children:[e.jsx(o,{variant:"h3",children:f()}),e.jsx(o,{variant:"h6",children:"New"})]})}),e.jsx(y,{item:!0,xs:6,sm:6,lg:3,children:e.jsxs(_,{onClick:v()!==0?()=>s(T("On Hold")):void 0,sx:{backgroundColor:"warning.light",color:"warning.main"},children:[e.jsx(o,{variant:"h3",children:v()}),e.jsx(o,{variant:"h6",children:"On Hold"})]})}),e.jsx(y,{item:!0,xs:6,sm:6,lg:3,children:e.jsxs(_,{onClick:j()!==0?()=>s(T("Closed")):void 0,sx:{backgroundColor:"error.light",color:"error.main"},children:[e.jsx(o,{variant:"h3",children:j()}),e.jsx(o,{variant:"h6",children:"Closed"})]})}),e.jsx(y,{item:!0,xs:6,sm:6,lg:3,children:e.jsxs(_,{onClick:h()!==0?()=>s(T("total_tickets")):void 0,sx:{backgroundColor:"primary.light",color:"primary.main"},children:[e.jsx(o,{variant:"h3",children:h()}),e.jsx(o,{variant:"h6",children:"Total"})]})})]})},Qe=Ge;var B={},Ze=P;Object.defineProperty(B,"__esModule",{value:!0});var ae=B.default=void 0,Je=Ze(D()),Ke=e,Ue=(0,Je.default)((0,Ke.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"}),"ChatBubbleOutline");ae=B.default=Ue;var R={},Ee=P;Object.defineProperty(R,"__esModule",{value:!0});var le=R.default=void 0,Xe=Ee(D()),Ye=e,et=(0,Xe.default)((0,Ye.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");le=R.default=et;var L={},tt=P;Object.defineProperty(L,"__esModule",{value:!0});var ie=L.default=void 0,st=tt(D()),rt=e,at=(0,st.default)((0,rt.jsx)("path",{d:"m10.54 11-.54-.54L7.54 8 6 6.46 2.38 2.84 1.27 1.73 0 3l2.01 2.01L2 22l4-4h9l5.73 5.73L22 22.46 17.54 18l-7-7zM8 14H6v-2h2v2zm-2-3V9l2 2H6zm14-9H4.08L10 7.92V6h8v2h-7.92l1 1H18v2h-4.92l6.99 6.99C21.14 17.95 22 17.08 22 16V4c0-1.1-.9-2-2-2z"}),"SpeakerNotesOff");ie=L.default=at;const lt={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",border:"none",boxShadow:24,p:4},it=({userEmail:l,totalPages:i,confirmedLocations:s,setFilterLocation:d,filterLocation:h})=>{const j=re(),[v,f]=m.useState(!1),[r,a]=m.useState(!1);m.useState(!1);const[$,H]=m.useState(0),[A,O]=m.useState(""),[M,oe]=m.useState(""),[ne,ce]=m.useState("");m.useState("");const[p,W]=m.useState({subject:"",description:"",location:h}),de=(t,n)=>{n=n-1,H(n*10)},V=t=>{d(t.target.value),j(_e(t.target.value)),p.location=t.target.value,W(w({},p)),console.log("Location = ",t.target.value),t.target.value!=="Property Location"&&localStorage.setItem("location",t.target.value)},{data:S,error:ct,isValidating:dt,mutate:ue}=Ce("Issue",{fields:["subject","creation","status","raised_by","name","description","location"],filters:h==="ALL"?[["raised_by","=",l]]:[["raised_by","=",l],["location","=",h]],limit_start:$,limit:10,orderBy:{field:"creation",order:"desc"}});var C=[];S&&(j(ye(S)),C=S);const he=()=>{f(!0)},F=()=>{f(!1)},me=(t,n,x)=>{a(!0),O(t),oe(n),ce(x)},z=()=>a(!1),pe=(t,n,x)=>{if(t!=null)switch(n){case"total_tickets":return t.filter(u=>u.subject.toLocaleLowerCase().includes(x));case"On Hold":return t.filter(u=>u.status==="On Hold"&&u.subject.toLocaleLowerCase().includes(x));case"Closed":return t.filter(u=>u.status==="Closed"&&u.subject.toLocaleLowerCase().includes(x));case"Open":return t.filter(u=>u.status==="Open"&&u.subject.toLocaleLowerCase().includes(x));default:throw new Error(`Unknown filter: ${n}`)}};C!=null&&(C=b(t=>pe(t.ticketReducer.tickets,t.ticketReducer.currentFilter,t.ticketReducer.ticketSearch)));const{createDoc:xe,isCompleted:ut}=Ne(),je=t=>K.success(t,{toastId:"success"}),q=t=>K.warn(t,{toastId:"warn"}),G=t=>{var u,Q;const n=(u=document.querySelector("#standard-basic"))==null?void 0:u.value.trim(),x=(Q=document.querySelector("#outlined-multiline-static"))==null?void 0:Q.value.trim();n!==""&&x!==""&&(p.subject=n,p.description=x,W(w({},p)))},fe=()=>{p.subject===""||p.description===""?q("Please fill the details"):p.location==="ALL"||p.location===""?q("Please Select the Location"):xe("Issue",p).then(()=>{je("Ticket created Successfully"),f(!1),ue()}).catch(t=>{console.log("inside catch "+JSON.stringify(t.message)),notifyError(t.message)})};return e.jsxs(c,{mt:4,children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(c,{}),e.jsx(c,{sx:{mb:2},children:(s==null?void 0:s.length)>=2?e.jsxs(U,{sx:{m:1,minWidth:170},children:[e.jsx(E,{id:"demo-simple-select-autowidth-label",children:"Property Location"}),e.jsx(X,{labelId:"demo-simple-select-autowidth-label",id:"demo-simple-select-autowidth",value:h,label:"Property Location",onChange:V,children:s==null?void 0:s.map((t,n)=>e.jsx(Y,{value:t.shortName,children:t.fullName},t.shortName+n))})]}):e.jsx(o,{variant:"h4",children:"This customer is not linked to any Location"})})]}),e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(c,{children:e.jsxs(k,{variant:"contained",onClick:he,children:["New Â ",e.jsx(le,{})]})}),e.jsx(c,{sx:{ml:"auto"},display:"flex",justifyContent:"space-between",alignItems:"center",children:e.jsx(I,{size:"small",label:"Search",fullWidth:!0,onChange:t=>j(Te(t.target.value))})})]}),e.jsx(Be,{children:e.jsxs(Re,{children:[e.jsx(Le,{children:e.jsxs(ee,{children:[e.jsx(g,{children:e.jsx(o,{variant:"h6",children:"Ticket"})}),e.jsx(g,{children:e.jsx(o,{variant:"h6",children:"Status"})}),e.jsx(g,{children:e.jsx(o,{variant:"h6",children:"Chat"})})]})}),e.jsx($e,{children:C&&C.map(t=>e.jsxs(ee,{hover:!0,children:[e.jsx(g,{onClick:()=>{me(t.subject,t.description,t.status)},style:{cursor:"pointer"},children:e.jsxs(c,{children:[e.jsx(o,{variant:"h6",fontWeight:"500",wrap:!0,children:t.subject}),e.jsx(o,{color:"textSecondary",noWrap:!0,sx:{maxWidth:"250px"},variant:"subtitle2",fontWeight:"400",children:t.ticketDescription})]})}),e.jsx(g,{children:e.jsx(He,{sx:{backgroundColor:t.status==="Open"?n=>n.palette.success.light:t.status==="Closed"?n=>n.palette.error.light:t.status==="On Hold"?n=>n.palette.warning.light:t.status==="Pending"},size:"small",label:t.status==="Open"?"New":`${t.status}`})}),t.status==="Closed"?e.jsx(g,{children:e.jsx(te,{color:"secondary",badgeContent:0,children:e.jsx(ie,{})})}):e.jsx(g,{component:ke,to:`/tickets_chat/${t.name}/${t.subject}`,children:e.jsx(te,{color:"secondary",badgeContent:0,children:e.jsx(ae,{})})})]},t.subject))})]})}),e.jsx(c,{my:3,display:"flex",justifyContent:"center",children:e.jsx(Ae,{count:i,color:"primary",onChange:de})}),e.jsx(Me,{open:r,onClose:z,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(c,{sx:lt,children:[e.jsxs(c,{children:[e.jsx(o,{id:"modal-modal-title",variant:"h6",component:"h2",style:{textDecoration:"underline"},children:"Ticket Name:"}),e.jsx(o,{id:"modal-modal-title",children:A})]}),e.jsxs(c,{children:[e.jsx(o,{id:"modal-modal-title",variant:"h6",component:"h2",style:{textDecoration:"underline",marginTop:"0.5rem"},children:"Ticket Description:"}),e.jsx(o,{id:"modal-modal-description",children:M||"No Description"})]}),e.jsxs(c,{children:[e.jsx(o,{id:"modal-modal-title",variant:"h6",component:"h2",style:{textDecoration:"underline",marginTop:"0.5rem"},children:"Ticket Status:"}),e.jsx(o,{id:"modal-modal-description",children:ne})]}),e.jsx(se,{children:e.jsx(k,{onClick:z,children:"Close"})})]})}),e.jsxs(We,{fullWidth:!0,maxWidth:"sm",open:v,onClose:F,children:[e.jsx(Fe,{children:"Raise a Ticket"}),e.jsxs(Ve,{children:[e.jsxs(c,{noValidate:!0,component:"form",sx:{display:"flex",flexDirection:"column",m:"auto",width:"90%"},children:[e.jsx(c,{children:e.jsx(I,{id:"standard-basic",label:"Ticket Title",variant:"standard",style:{width:"100%"},onChange:t=>{G()}})}),e.jsx(c,{sx:{mt:3},children:e.jsx(I,{id:"outlined-multiline-static",label:"Ticket Description",multiline:!0,rows:4,style:{width:"100%"},onChange:t=>{G()}})}),e.jsx(ze,{disableFocusListener:!0,disableTouchListener:!0,placement:"right-end",TransitionComponent:qe,title:"Property for which you want to rise ticket",children:(s==null?void 0:s.length)>=2?e.jsx(c,{children:e.jsxs(U,{fullWidth:!0,sx:{mt:3},children:[e.jsx(E,{id:"demo-simple-select-label",children:"Property Location"}),e.jsx(X,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:h,label:"Property Location",onChange:V,children:s==null?void 0:s.map(t=>e.jsx(Y,{value:t.shortName,children:t.fullName},t.shortName))})]})}):e.jsx(o,{variant:"h4",sx:{mt:3},children:"This customer is not linked to any Location"})}),e.jsx(k,{variant:"contained",sx:{mt:3},onClick:fe,disabled:(s==null?void 0:s.length)===1,children:"Submit"})]}),e.jsx(Pe,{position:"top-center",autoClose:1e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"})]}),e.jsx(se,{children:e.jsx(k,{onClick:F,children:"Close"})})]})]})},ot=it,nt=[{to:"/dashboard",title:"Home"},{title:"Tickets"}];function js(){const l=b(a=>a.novelprofileReducer.userEmail);b(a=>a.novelprofileReducer.fullName);const i=b(a=>a.novelprofileReducer.companyName),s=b(a=>a.novelprofileReducer.location),[d,h]=m.useState(s);m.useEffect(()=>{let a=localStorage.getItem("location");a!=="Property Location"&&h(a)},[s]),d===null&&h("ALL");const{data:j}=N("Issue",d==="ALL"?["raised_by","=",l]:[["raised_by","=",l],["location","=",d]],!1),v=Math.ceil(j/10)||1;var r=(()=>{const{data:a,error:$,isValidating:H,mutate:A}=Oe("Customer",`${i}`);return console.log("CompanyName = ",i),a==null?void 0:a.leads.map(O=>O.confirmed_location)})();return r=r==null?void 0:r.map(a=>{switch(a){case"NTP":return{shortName:a,fullName:"NTP-Kudlu Gate"};case"NOM":return{shortName:a,fullName:"NOM-Marathahalli"};case"NOC":return{shortName:a,fullName:"NOC-MG Road"};case"NOQ":return{shortName:a,fullName:"NOQ-Brigade Road"};case"NOW":return{shortName:a,fullName:"NOW-Whitefield"};case"NBP":return{shortName:a,fullName:"NBP-Adugodi"};case"NOB":return{shortName:a,fullName:"NBP-ITPL"};default:return{shortName:a,fullName:a}}}),r==null||r.unshift({shortName:"ALL",fullName:"ALL"}),e.jsxs(we,{title:"Tickets - Novel Office",description:"this is Note page",children:[e.jsx(Se,{title:"Tickets app",items:nt}),e.jsxs(Ie,{children:[e.jsx(Qe,{userEmail:l,filterLocation:d}),e.jsx(ot,{userEmail:l,totalPages:v,confirmedLocations:r,filterLocation:d,setFilterLocation:h})]})]})}export{js as default};
